CREATE TABLE t1 (
id int NOT NULL PRIMARY KEY,
item_id varchar(100),
seller_name varchar(400),
variant varchar(400),
FULLTEXT KEY t1_serial_IDX (item_id,seller_name,variant)
)engine=innodb;
insert into t1 select seq,seq,seq,seq from seq_1_to_10000;
analyze # format=json
DELETE FROM t1 WHERE id NOT IN
(SELECT m FROM (SELECT max(id) m FROM t1 GROUP BY item_id, seller_name, variant) AS innertable);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	r_rows	filtered	r_filtered	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	10407	10000.00	100.00	0.00	Using where
2	SUBQUERY	<derived3>	index_subquery	distinct_key	distinct_key	5	func	2083	NULL	100.00	NULL	
3	DERIVED	t1	ALL	NULL	NULL	NULL	NULL	10407	10000.00	100.00	100.00	Using temporary; Using filesort
analyze # format=json
UPDATE t1 SET item_id="foo" WHERE id NOT IN
(SELECT m FROM (SELECT max(id) m FROM t1 GROUP BY item_id, seller_name, variant) AS innertable);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	r_rows	filtered	r_filtered	Extra
1	PRIMARY	t1	index	NULL	PRIMARY	4	NULL	10407	10000.00	100.00	0.00	Using where
2	SUBQUERY	<derived3>	index_subquery	distinct_key	distinct_key	5	func	2083	NULL	100.00	NULL	
3	DERIVED	t1	ALL	NULL	NULL	NULL	NULL	10407	10000.00	100.00	100.00	Using temporary; Using filesort
drop table t1;
