--source include/have_utf32.inc

--disable_warnings
drop table if exists con, aux, nul, lpt1, com1, `clock$`;
--enable_warnings

create table con (a int);
drop table con;

create table aux (a int);
drop table aux;

create table nul (a int);
drop table nul;

create table lpt1 (a int);
drop table lpt1;

create table com1 (a int);
drop table com1;

create table `clock$` (a int);
drop table `clock$`;

# Enable after fix MDEV-29295
--disable_view_protocol
select convert(convert(',' using filename) using binary);
--enable_view_protocol 

--echo #
--echo # MDEV-7677 my_charset_handler_filename has a wrong "ismbchar" member
--echo #
SET NAMES utf8;
SELECT @a:=CONVERT('a—è' USING filename) AS `@a`, BINARY @a, REVERSE(@a), HEX(@a), HEX(REVERSE(@a));

--echo #
--echo # Beginning of 10.2 test.
--echo #
--echo # MDEV-25462: Assertion `m_status == DA_ERROR || m_status == DA_OK ||
--echo # m_status == DA_OK_BULK' failed in Diagnostics_area::message from
--echo # get_schema_tables_record
--echo #

SELECT @@character_set_client, @@character_set_connection, @@character_set_results;
SET @old_character_set_client= @@character_set_client;
SET @old_character_set_connection= @@character_set_connection;
SET @old_character_set_results= @@character_set_results;
--error ER_WRONG_VALUE_FOR_VAR
SET NAMES 'filename';
SELECT @@character_set_client, @@character_set_connection, @@character_set_results;
CREATE VIEW v2 AS SELECT 1;
SHOW TABLE STATUS;
DROP VIEW v2;
SET @@character_set_client= @old_character_set_client;
SET @@character_set_connection= @old_character_set_connection;
SET @@character_set_results= @old_character_set_results;

--echo #
--echo # End of 10.2 test
--echo #

--echo #
--echo # MDEV-22022 Various mangled SQL statements will crash 10.3 to 10.5 debug builds
--echo #

--error ER_WRONG_VALUE_FOR_VAR
SET CHARACTER_SET_CLIENT=17;
--error ER_PARSE_ERROR
SELECT doc.`Children`.0 FROM t1;
SET NAMES latin1;

--echo # End of 10.3 tests

--echo #
--echo # MDEV-22043 Special character leads to assertion in my_wc_to_printable_generic on 10.5.2 (debug)
--echo #

--error ER_WRONG_VALUE_FOR_VAR
SET NAMES filename;
--error ER_PARSE_ERROR
EXECUTE IMMEDIATE _latin1 0x01;
SET NAMES utf8;

--echo #
--echo # MDEV-23435 Functions do not convert numbers to character_set_results
--echo #

--disable_ps_protocol

SET NAMES utf8, character_set_results=filename;

CREATE TABLE t1 (a DATETIME(6));
INSERT INTO t1 VALUES ('2001-01-01 00:00:00.000000');
SELECT a, COALESCE(a) AS c FROM t1;
DROP TABLE t1;

CREATE TABLE t1 (a TIME(6));
INSERT INTO t1 VALUES ('00:00:00.000000');
SELECT a, COALESCE(a) AS c FROM t1;
DROP TABLE t1;

CREATE TABLE t1 (a DATE);
INSERT INTO t1 VALUES ('2001-01-01');
SELECT a, COALESCE(a) AS c FROM t1;
DROP TABLE t1;

CREATE TABLE t1 (a TINYINT);
INSERT INTO t1 VALUES (-1);
SELECT a, COALESCE(a) AS c FROM t1;
DROP TABLE t1;

CREATE TABLE t1 (a SMALLINT);
INSERT INTO t1 VALUES (-1);
SELECT a, COALESCE(a) AS c FROM t1;
DROP TABLE t1;

CREATE TABLE t1 (a MEDIUMINT);
INSERT INTO t1 VALUES (-1);
SELECT a, COALESCE(a) AS c FROM t1;
DROP TABLE t1;

CREATE TABLE t1 (a BIGINT);
INSERT INTO t1 VALUES (-1);
SELECT a, COALESCE(a) AS c FROM t1;
DROP TABLE t1;

CREATE TABLE t1 (a DECIMAL(10.2));
INSERT INTO t1 VALUES (-1);
SELECT a, COALESCE(a) AS c FROM t1;
DROP TABLE t1;

CREATE TABLE t1 (a FLOAT);
INSERT INTO t1 VALUES (-1);
SELECT a, COALESCE(a) AS c FROM t1;
DROP TABLE t1;

CREATE TABLE t1 (a DOUBLE);
INSERT INTO t1 VALUES (-1);
SELECT a, COALESCE(a) AS c FROM t1;
DROP TABLE t1;

SET NAMES utf8;

--enable_ps_protocol

--echo # End of 10.5 tests

--echo #
--echo # Start of 10.9 tests
--echo #

--echo #
--echo # MDEV-28481 SIGSEGV in Lex_charset_collation_st::find_bin_collation
--echo #

SET SESSION collation_server=filename;
CREATE DATABASE db1;
USE db1;
--error ER_UNKNOWN_COLLATION
CREATE TABLE t (c CHAR BINARY);
DROP DATABASE db1;
USE test;
SET NAMES latin1;

--error ER_UNKNOWN_COLLATION
CREATE TABLE t1 (c CHAR BINARY) CHARACTER SET filename;

--echo #
--echo # End of 10.9 tests
--echo #


--echo #
--echo # Start of 11.7 tests
--echo #

--echo #
--echo # MDEV-27490 Allow full utf8mb4 for identifiers
--echo #

CREATE OR REPLACE TABLE t1 (a CHAR CHARACTER SET utf32);
INSERT INTO t1 VALUES (0x10000), (0x1FFFF);
INSERT INTO t1 VALUES (0x20000), (0x2FFFF);
INSERT INTO t1 VALUES (0x30000), (0x3FFFF);
INSERT INTO t1 VALUES (0xE0000), (0xEFFFF);
INSERT INTO t1 VALUES (0xF0000), (0xFFFFF);
INSERT INTO t1 VALUES (0x100000), (0x10FFFF);

SELECT hex(a), BINARY CONVERT(a USING filename) FROM t1;
DROP TABLE t1;

--echo #
--echo # End of 11.7 tests
--echo #
