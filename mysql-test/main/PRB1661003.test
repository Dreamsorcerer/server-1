# Defect DEF0370542
--source include/have_innodb.inc
--source include/have_stat_tables.inc

CREATE TABLE `ts_word` (
      `word` varchar(40) DEFAULT NULL,
      `number` int(11) NOT NULL,
      PRIMARY KEY (`number`),
      UNIQUE KEY `ts_word_u` (`word`)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--disable_query_log
--disable_result_log

set @save_use_stat_tables=@@use_stat_tables;
set @save_tmp_cond_selectivity= @@optimizer_use_condition_selectivity;
set @save_sn_order_by_limit_optimize_level= @@sn_order_by_limit_optimize_level;

set @save_optimizer_switch_for_selectivity_test=@@optimizer_switch;

SET optimizer_use_condition_selectivity = 1;
set optimizer_switch='rowid_filter=off';
set use_stat_tables='never';

--enable_result_log
--enable_query_log

echo # Should select all_k -- only using cost;
SET sn_order_by_limit_optimize_level = 5;
explain format=json SELECT * FROM ts_word ORDER BY number LIMIT 1;

--disable_query_log
--disable_result_log

# cleanup ...
SET optimizer_use_condition_selectivity = @save_tmp_cond_selectivity;
SET optimizer_switch = @save_optimizer_switch_for_selectivity_test;
SET optimizer_trace='enabled=off';
SET sn_order_by_limit_optimize_level = @save_sn_order_by_limit_optimize_level;
SET use_stat_tables=@save_use_stat_tables;

drop table ts_word;

--enable_result_log
--enable_query_log
