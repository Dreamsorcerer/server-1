include/master-slave.inc
[connection master]
# Configuration param
connection master;
create table t1 (a int) engine=aria;
include/save_master_gtid.inc
connection slave;
include/sync_with_master_gtid.inc
include/stop_slave.inc
change master to master_delay=SLAVE_DELAY;
include/start_slave.inc
connection master;
# Sleep 2 to ensure DDL and DML have different binlog timestamps
connection slave;
flush logs;
connection master;
set @@timestamp= TIMESTAMP;
insert into t1 values (sleep(2));
include/save_master_gtid.inc
# Waiting for slave to delay and commit transaction..
connection slave;
include/sync_with_master_gtid.inc
# MYSQL_BINLOG slave_local_binlog > slave_outfile
include/assert_grep.inc [Ensure slave doesn't overwrite exec_time in the binlog event]
#
# Cleanup
connection slave;
include/stop_slave.inc
change master to master_delay=0;
include/start_slave.inc
connection master;
drop table t1;
include/rpl_end.inc
# End of tests
